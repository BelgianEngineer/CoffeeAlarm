<!-- IOT Particle photon - Coffee machine - Quentin Mannes -->
<!DOCTYPE>
<html>

<head>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	
</head>

<body onload="getAlarmStatus()">

	<center>
		<br>
		<br>
		<br>
		
		<div id="controlPage">
		
			<p>
			<span style="font-weight: bold; font-size: 30;">Coffee control page</span>
			<br>
			<br>
			
			<p>
			<span style="font-weight: bold; font-size: 20;">Actions:</span>
	<table style="width:100%; border: 1px solid black;">
	<tr><td style="padding: 10px">

			<p>
			<form>
				<input type="radio"  name="arg" value="on" onclick="alarmOnOff(this.value);">Alarm on.
				<br>
				<input type="radio"  name="arg" value="off" onclick="alarmOnOff(this.value);">Alarm off.
				<br>
			</form>

			<p>
			Alarm time 	
			<select name="hour" id="hour" size="1">
				<option value="00">00
				<option value="01">01
				<option value="02">02
				<option value="03">03
				<option value="04">04
				<option value="05">05
				<option value="06">06
				<option value="07">07
				<option value="08">08
				<option value="09">09
				<option value="10">10
				<option value="11">11
				<option value="12">12
				<option value="13">13
				<option value="14">14
				<option value="15">15
				<option value="16">16
				<option value="17">17
				<option value="18">18
				<option value="19">19
				<option value="20">20
				<option value="21">21
				<option value="22">22
				<option value="23">23
			</select>
			:
			<select name="minute" id="minute" size="1">
				<option value="00">00
				<option value="05">05
				<option value="10">10
				<option value="15">15
				<option value="20">20
				<option value="25">25
				<option value="30">30
				<option value="35">35
				<option value="40">40
				<option value="45">45
				<option value="50">50
				<option value="55">55
				
			</select>
			<button id="AlarmButton" onclick="setAlarm(getElementById('hour').value + getElementById('minute').value)">Set</button>
			
			<p>
			<input type="text" id="yourMessage" value="Your message" onfocus="this.value=''" maxlength="16">
			<button id="messageButton" onclick="setMessage(getElementById('yourMessage').value)">Set</button>
			
			<p>
			<button id="brewButton" onclick="brew()">BREW</button>
	</table>
			
			<p>
			<span style="font-weight: bold; font-size: 20;">Status:</span>
	<table style="width:100%; border: 1px solid black;">
	<tr><td style="padding: 10px">
			<p>
			<strong>Alarm status:</strong> <span id="alarmStatus"></span>
			<br>
			<strong>Alarm time:</strong> <span id="alarmHour"></span><span id="alarmMinute"></span>
			<br>
			<strong>Message:</strong> <span id="message"></span>
			<br>
	</table>
	
		</div>

		<p>
		<button id="hide" onclick="accessForm()">HIDE</button>
		
		<script type="text/javascript">
		
			<!-- ACCESS CREDENTIALS -->
			var deviceID    = "DEVICE_ID";
			var accessToken = "ACCESS_TOKEN";

			<!-- Get value every period -->
			setInterval(getAlarmStatus, 20000);    //Check value at startup then very low freq but recheck after every corresponding action
			
			// ------------------ WEB DISPLAY FUNCTIONS ----------------
			
			<!-- DISPLAY AFTER PASS -->
			function accessForm()
			{
				document.getElementById('controlPage').style.display = 'none';
			}
			
			// ----------------------- VARIABLES -----------------------
			
			<!-- ALARM STATUS -->
			function getAlarmStatus() 
			{
				var getFunc = "alarmStatus";
			
					var requestURL = "https://api.particle.io/v1/devices/" + deviceID + "/" + getFunc + "/?access_token=" + accessToken;
					$.getJSON(requestURL, function(jsonString) 
				{
					document.getElementById('alarmStatus').innerHTML = jsonString.result;
				});
				
				getAlarmTime();
			}
			
			<!-- ALARM TIME -->
			function getAlarmTime() 
			{
				var getFunc = "alarmHour";
			
					var requestURL = "https://api.particle.io/v1/devices/" + deviceID + "/" + getFunc + "/?access_token=" + accessToken;
					$.getJSON(requestURL, function(jsonString) 
				{
				document.getElementById('alarmHour').innerHTML = jsonString.result+":";
				});
				
				
				var getFunc = "alarmMinute";
			
					var requestURL = "https://api.particle.io/v1/devices/" + deviceID + "/" + getFunc + "/?access_token=" + accessToken;
					$.getJSON(requestURL, function(jsonString) 
				{
				document.getElementById('alarmMinute').innerHTML = jsonString.result;
				});
				
				getMessage();
			}
			
			<!-- MESSAGE -->
			function getMessage() 
			{
				var getFunc = "yourMessage";
			
					var requestURL = "https://api.particle.io/v1/devices/" + deviceID + "/" + getFunc + "/?access_token=" + accessToken;
					$.getJSON(requestURL, function(jsonString) 
				{
					document.getElementById('message').innerHTML = jsonString.result;
				});				
			}
			
			// ------------------------ ACTIONS ------------------------
			
			<!-- ALARM ON OR OFF -->
			function alarmOnOff(status) 
			{
			var setFunc = "alarmOnOff";
			var paramStr = status;

				requestURL = "https://api.particle.io/v1/devices/" +deviceID + "/" + setFunc + "/";
				$.post( requestURL, { params: paramStr, access_token: accessToken });
				
			getAlarmStatus();
			}
		 
			<!-- SET ALARM TIME -->
			function setAlarm(HHMM) 
			{
			var setFunc = "setAlarm";
			var paramStr = HHMM;

				var requestURL = "https://api.particle.io/v1/devices/" +deviceID + "/" + setFunc + "/";
				$.post( requestURL, { params: paramStr, access_token: accessToken });
				
				getAlarmTime()
			}
			
			<!-- SET MESSAGE -->
			function setMessage(yourMessage) 
			{
			var setFunc = "setMessage";
			var paramStr = yourMessage;

				var requestURL = "https://api.particle.io/v1/devices/" +deviceID + "/" + setFunc + "/";
				$.post( requestURL, { params: paramStr, access_token: accessToken });
				
				getMessage()
			}
			
			<!-- START BREW -->
			function brew() 
			{
			var setFunc = "brew";
			var paramStr = "Coffee ready!";

				var requestURL = "https://api.particle.io/v1/devices/" +deviceID + "/" + setFunc + "/";
				$.post( requestURL, { params: paramStr, access_token: accessToken });
			}
			
			
		</script>
  
	</center>
	
</body>

</html>